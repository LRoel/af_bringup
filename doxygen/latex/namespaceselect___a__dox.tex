\hypertarget{namespaceselect___a__dox}{}\section{select\+\_\+\+A\+\_\+dox Namespace Reference}
\label{namespaceselect___a__dox}\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classselect___a__dox_1_1_a_m_c_l__unit}{A\+M\+C\+L\+\_\+unit}
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L存储类 \end{DoxyCompactList}\item 
class \hyperlink{classselect___a__dox_1_1_g_p_s__unit}{G\+P\+S\+\_\+unit}
\begin{DoxyCompactList}\small\item\em G\+P\+S数据存储类 \end{DoxyCompactList}\item 
class \hyperlink{classselect___a__dox_1_1_odom__unit}{Odom\+\_\+unit}
\begin{DoxyCompactList}\small\item\em 里程计数据存储类 \end{DoxyCompactList}\item 
class \hyperlink{classselect___a__dox_1_1_s_e_l_e_c_t_e_d}{S\+E\+L\+E\+C\+T\+ED}
\begin{DoxyCompactList}\small\item\em 筛选结果类 \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}{normalize} (z)
\begin{DoxyCompactList}\small\item\em 归一化 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a2e96d33700cc43f6769c8717a1538684}{angle\+\_\+diff} (a, b)
\begin{DoxyCompactList}\small\item\em 角度差值 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_aeb9ae60d7e093e9212176c74ab48f697}{matrix\+\_\+from\+\_\+theta} (theta)
\begin{DoxyCompactList}\small\item\em 角度生成旋转矩阵(2x2) \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a7b416b405b394ffdf3fb7ca9d91bd896}{theta\+\_\+from\+\_\+matrix} (R)
\begin{DoxyCompactList}\small\item\em 旋转矩阵(2x2)转成角度 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a6b1af471c24514010bab83a744995d30}{send\+Transform} (out\+\_\+pose)
\begin{DoxyCompactList}\small\item\em 发送\+T\+F(topic) \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_ac19f6260515ad57d2a375614405ec33d}{tran\+\_\+mat44} (trans)
\begin{DoxyCompactList}\small\item\em 将ros格式中的\+Transform数据转为矩阵(4\+X4) \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a62a8e3ea1a92df75e0ca42190f621777}{tran\+\_\+theta\+\_\+T} (trans)
\begin{DoxyCompactList}\small\item\em 将ros格式中的\+Transform数据转为矩阵(2\+X2) \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a0a0029d6640915baf31f3cb76c0658ab}{make\+\_\+choice} ()
\begin{DoxyCompactList}\small\item\em 筛选函数 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_aaae6f4a3d568931c6038b1e3cbfb6f9a}{amcl\+\_\+initial\+\_\+update} (x\+\_\+std=1, y\+\_\+std=1, theta\+\_\+std=1)
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L初始化函数 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a843ff715ed42a01fc98f2199ea314cea}{amcl\+\_\+initial\+\_\+callback} (msg)
\begin{DoxyCompactList}\small\item\em A\+M\+CL 初始化回调函数 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a4c38eb63cc34fdb7d60461a006f34100}{amcl\+\_\+global\+\_\+update} ()
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L全局撒粒子 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a1c4df087055bbe2cb5ce63c92a51d493}{amcl\+\_\+nomotion\+\_\+update} ()
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L未运动状态下粒子更新 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}{amcl\+\_\+recovery} ()
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L恢复状态过程 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_afd73791153a71f1fcddb1b58d87fcf6e}{amcl\+\_\+process} ()
\begin{DoxyCompactList}\small\item\em A\+M\+C\+L线程 \end{DoxyCompactList}\item 
def \hyperlink{namespaceselect___a__dox_a3b1a91ee1ddc60fac7981f8cb5ea0368}{main} ()
\begin{DoxyCompactList}\small\item\em 主函数 \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{namespaceselect___a__dox_ae625bd87a3d659c478623a68cd8419a0}{M\+A\+X\+\_\+\+S\+TD} = 999999999
\begin{DoxyCompactList}\small\item\em 最大的标准差 \end{DoxyCompactList}\item 
int \hyperlink{namespaceselect___a__dox_aab650782f9bf9e653748df1ce43ba0a3}{flag\+\_\+robot\+\_\+move} = 0
\begin{DoxyCompactList}\small\item\em 机器人是否运动标志 \end{DoxyCompactList}\item 
float \hyperlink{namespaceselect___a__dox_a0fedd571655449b271f61079a0c85510}{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR} = 0.\+05
\begin{DoxyCompactList}\small\item\em 判断机器人是否运动的速度限制 \end{DoxyCompactList}\item 
float \hyperlink{namespaceselect___a__dox_a8c2c2dd96dd9f11315bf9092c248b7f6}{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR} = 0.\+05
\begin{DoxyCompactList}\small\item\em 判断机器人是否运动的角度限制 \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceselect___a__dox_a4c38eb63cc34fdb7d60461a006f34100}\label{namespaceselect___a__dox_a4c38eb63cc34fdb7d60461a006f34100}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+global\+\_\+update@{amcl\+\_\+global\+\_\+update}}
\index{amcl\+\_\+global\+\_\+update@{amcl\+\_\+global\+\_\+update}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+global\+\_\+update()}{amcl\_global\_update()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+global\+\_\+update (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A\+M\+C\+L全局撒粒子 


\begin{DoxyCode}
555 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a4c38eb63cc34fdb7d60461a006f34100}{amcl\_global\_update}():
556     rospy.wait\_for\_service(\textcolor{stringliteral}{'global\_localization'})
557     \textcolor{keywordflow}{try}:
558         global\_update = rospy.ServiceProxy(\textcolor{stringliteral}{'global\_localization'}, Empty)
559         global\_update()
560     \textcolor{keywordflow}{except} rospy.ServiceException, e:
561         \textcolor{keywordflow}{print} \textcolor{stringliteral}{"Service call failed: %s"} % e
562 
563 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a843ff715ed42a01fc98f2199ea314cea}\label{namespaceselect___a__dox_a843ff715ed42a01fc98f2199ea314cea}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+initial\+\_\+callback@{amcl\+\_\+initial\+\_\+callback}}
\index{amcl\+\_\+initial\+\_\+callback@{amcl\+\_\+initial\+\_\+callback}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+initial\+\_\+callback()}{amcl\_initial\_callback()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+initial\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{msg }\end{DoxyParamCaption})}



A\+M\+CL 初始化回调函数 


\begin{DoxyParams}{Parameters}
{\em msg} & ros回调数据 \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
541 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a843ff715ed42a01fc98f2199ea314cea}{amcl\_initial\_callback}(msg):
542 
543     \textcolor{comment}{# msg = PoseWithCovarianceStamped()}
544     \textcolor{keyword}{global} amcl\_output
545     \textcolor{keywordflow}{print} \textcolor{stringliteral}{"  "}
546     \textcolor{comment}{# amcl\_output.x = msg.pose.pose.position.x}
547     \textcolor{comment}{# amcl\_output.y = msg.pose.pose.position.y}
548     \textcolor{comment}{# \_quat = [msg.pose.pose.orientation.x, msg.pose.pose.orientation.y,}
549     \textcolor{comment}{#          msg.pose.pose.orientation.z,}
550     \textcolor{comment}{#          msg.pose.pose.orientation.w]}
551     \textcolor{comment}{# amcl\_output.theta = tft.euler\_from\_quaternion(\_quat)[2]}
552 
553 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_aaae6f4a3d568931c6038b1e3cbfb6f9a}\label{namespaceselect___a__dox_aaae6f4a3d568931c6038b1e3cbfb6f9a}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+initial\+\_\+update@{amcl\+\_\+initial\+\_\+update}}
\index{amcl\+\_\+initial\+\_\+update@{amcl\+\_\+initial\+\_\+update}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+initial\+\_\+update()}{amcl\_initial\_update()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+initial\+\_\+update (\begin{DoxyParamCaption}\item[{}]{x\+\_\+std = {\ttfamily 1},  }\item[{}]{y\+\_\+std = {\ttfamily 1},  }\item[{}]{theta\+\_\+std = {\ttfamily 1} }\end{DoxyParamCaption})}



A\+M\+C\+L初始化函数 


\begin{DoxyParams}{Parameters}
{\em x\+\_\+std} & x方向方差 \\
\hline
{\em y\+\_\+std} & y方向方差 \\
\hline
{\em theta\+\_\+std} & 角度房车 \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
506 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_aaae6f4a3d568931c6038b1e3cbfb6f9a}{amcl\_initial\_update}(x\_std=1, y\_std=1, theta\_std=1):
507 
508     rate = rospy.Rate(10)
509     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} rospy.is\_shutdown():
510         \textcolor{keywordflow}{try}:
511             trans = tfBuffer.lookup\_transform(\textcolor{stringliteral}{'map'}, \textcolor{stringliteral}{'base\_footprint'}, rospy.Time())
512         \textcolor{keywordflow}{except} (tf2\_ros.LookupException, tf2\_ros.ConnectivityException, tf2\_ros.ExtrapolationException):
513             rate.sleep()
514             \textcolor{keywordflow}{continue}
515 
516         \textcolor{keyword}{global} pub\_amcl
517         amcl\_init\_pose.header.stamp = rospy.Time.now()
518         amcl\_init\_pose.header.frame\_id = \textcolor{stringliteral}{"map"}
519         amcl\_init\_pose.pose.pose.position.x = trans.transform.translation.x
520         amcl\_init\_pose.pose.pose.position.y = trans.transform.translation.y
521         amcl\_init\_pose.pose.pose.position.z = trans.transform.translation.z
522         amcl\_init\_pose.pose.pose.orientation.x = trans.transform.rotation.x
523         amcl\_init\_pose.pose.pose.orientation.y = trans.transform.rotation.y
524         amcl\_init\_pose.pose.pose.orientation.z = trans.transform.rotation.z
525         amcl\_init\_pose.pose.pose.orientation.w = trans.transform.rotation.w
526         amcl\_init\_pose.pose.covariance = [0.0] * 36
527         amcl\_init\_pose.pose.covariance[0] = x\_std ** 2
528         amcl\_init\_pose.pose.covariance[7] = y\_std ** 2
529         amcl\_init\_pose.pose.covariance[35] = theta\_std ** 2
530         pub\_amcl.publish(amcl\_init\_pose)
531         \textcolor{keywordflow}{break}
532         \textcolor{comment}{# print "pub amcl ok" + str(input\_yaw)}
533 
534 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a1c4df087055bbe2cb5ce63c92a51d493}\label{namespaceselect___a__dox_a1c4df087055bbe2cb5ce63c92a51d493}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+nomotion\+\_\+update@{amcl\+\_\+nomotion\+\_\+update}}
\index{amcl\+\_\+nomotion\+\_\+update@{amcl\+\_\+nomotion\+\_\+update}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+nomotion\+\_\+update()}{amcl\_nomotion\_update()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+nomotion\+\_\+update (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A\+M\+C\+L未运动状态下粒子更新 


\begin{DoxyCode}
565 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a1c4df087055bbe2cb5ce63c92a51d493}{amcl\_nomotion\_update}():
566     rospy.wait\_for\_service(\textcolor{stringliteral}{'request\_nomotion\_update'})
567     \textcolor{keywordflow}{try}:
568         nomotion\_update = rospy.ServiceProxy(\textcolor{stringliteral}{'request\_nomotion\_update'}, Empty)
569         nomotion\_update()
570     \textcolor{keywordflow}{except} rospy.ServiceException, e:
571         \textcolor{keywordflow}{print} \textcolor{stringliteral}{"Service call failed: %s"} % e
572 
573 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_afd73791153a71f1fcddb1b58d87fcf6e}\label{namespaceselect___a__dox_afd73791153a71f1fcddb1b58d87fcf6e}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+process@{amcl\+\_\+process}}
\index{amcl\+\_\+process@{amcl\+\_\+process}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+process()}{amcl\_process()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+process (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A\+M\+C\+L线程 

包括\+A\+M\+C\+L位置纠正,A\+M\+C\+L位置正确度判断和\+A\+M\+C\+L自恢复 
\begin{DoxyCode}
605 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_afd73791153a71f1fcddb1b58d87fcf6e}{amcl\_process}():
606 
607     \textcolor{keyword}{global} amcl\_output
608     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} rospy.is\_shutdown():
609         \textcolor{keywordflow}{if} \hyperlink{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}{amcl\_recovery}():
610             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"ok"}
611             \textcolor{keywordflow}{break}
612     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} rospy.is\_shutdown():
613         \textcolor{keywordflow}{if} amcl\_pose.x\_std > 0.5 \textcolor{keywordflow}{or} amcl\_pose.y\_std > 0.5:
614             rospy.wait\_for\_message(\textcolor{stringliteral}{'/scan'}, LaserScan)
615             n = 0
616             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} rospy.is\_shutdown():
617                 \textcolor{keywordflow}{if} n <= 4:
618                     \hyperlink{namespaceselect___a__dox_aaae6f4a3d568931c6038b1e3cbfb6f9a}{amcl\_initial\_update}()
619                     \textcolor{keywordflow}{print} \textcolor{stringliteral}{"amcl\_initial"}
620                 \textcolor{keywordflow}{else}:
621                     \textcolor{keywordflow}{if} (n - 5) % 5 == 0:
622                         \hyperlink{namespaceselect___a__dox_a4c38eb63cc34fdb7d60461a006f34100}{amcl\_global\_update}()
623                         \textcolor{keywordflow}{print} \textcolor{stringliteral}{"amcl\_global"}
624                 n += 1
625                 \textcolor{keywordflow}{if} \hyperlink{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}{amcl\_recovery}():
626                     \textcolor{keywordflow}{print} \textcolor{stringliteral}{"recovery ok"}
627                     amcl\_output.x = amcl\_pose.x
628                     amcl\_output.y = amcl\_pose.y
629                     amcl\_output.theta = amcl\_pose.theta
630                     \textcolor{keywordflow}{break}
631             \textcolor{keywordflow}{print} \textcolor{stringliteral}{'!!!!!!!!!!!!!!!!!!!!'}
632         \textcolor{keywordflow}{else}:
633             amcl\_output.x = amcl\_pose.x
634             amcl\_output.y = amcl\_pose.y
635             amcl\_output.theta = amcl\_pose.theta
636             \textcolor{keywordflow}{print} amcl\_pose.x\_std, amcl\_pose.y\_std
637             \textcolor{comment}{# print "amcl\_ok"}
638 
639 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}\label{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!amcl\+\_\+recovery@{amcl\+\_\+recovery}}
\index{amcl\+\_\+recovery@{amcl\+\_\+recovery}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{amcl\+\_\+recovery()}{amcl\_recovery()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+amcl\+\_\+recovery (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A\+M\+C\+L恢复状态过程 


\begin{DoxyCode}
575 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a37dfe6ff00e8834a1d53c1612354758c}{amcl\_recovery}():
576     \textcolor{keyword}{global} amcl\_pose
577     \textcolor{keywordflow}{if} flag\_robot\_move:
578         t = 0
579         \textcolor{keywordflow}{while} t < 15:
580             time.sleep(1)
581             \textcolor{keywordflow}{print} amcl\_pose.x\_std, amcl\_pose.y\_std
582             \textcolor{keywordflow}{if} amcl\_pose.x\_std > 0.5 \textcolor{keywordflow}{or} amcl\_pose.y\_std > 0.5:
583                 t += 1
584             \textcolor{keywordflow}{else}:
585                 \textcolor{keywordflow}{return} \textcolor{keyword}{True}
586         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
587     \textcolor{keywordflow}{else}:
588         t = 0
589         \textcolor{keywordflow}{while} t < 15:
590             time.sleep(1)
591             \hyperlink{namespaceselect___a__dox_a1c4df087055bbe2cb5ce63c92a51d493}{amcl\_nomotion\_update}()
592             \textcolor{keywordflow}{print} amcl\_pose.x\_std, amcl\_pose.y\_std
593             \textcolor{keywordflow}{if} amcl\_pose.x\_std > 0.5 \textcolor{keywordflow}{or} amcl\_pose.y\_std > 0.5:
594                 t += 1
595             \textcolor{keywordflow}{else}:
596                 \textcolor{keywordflow}{return} \textcolor{keyword}{True}
597         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
598 
599 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a2e96d33700cc43f6769c8717a1538684}\label{namespaceselect___a__dox_a2e96d33700cc43f6769c8717a1538684}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!angle\+\_\+diff@{angle\+\_\+diff}}
\index{angle\+\_\+diff@{angle\+\_\+diff}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{angle\+\_\+diff()}{angle\_diff()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+angle\+\_\+diff (\begin{DoxyParamCaption}\item[{}]{a,  }\item[{}]{b }\end{DoxyParamCaption})}



角度差值 


\begin{DoxyParams}{Parameters}
{\em a} & 输入角度 \\
\hline
{\em b} & 输入角度\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
角度差值 
\end{DoxyReturn}

\begin{DoxyCode}
64 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a2e96d33700cc43f6769c8717a1538684}{angle\_diff}(a, b):
65 
66     a = \hyperlink{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}{normalize}(a)
67     b = \hyperlink{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}{normalize}(b)
68     d1 = a - b
69     d2 = 2 * math.pi - math.fabs(d1)
70     \textcolor{keywordflow}{if} d1 > 0:
71         d2 *= -1.0
72     \textcolor{keywordflow}{if} math.fabs(d1) < math.fabs(d2):
73         \textcolor{keywordflow}{return} d1
74     \textcolor{keywordflow}{else}:
75         \textcolor{keywordflow}{return} d2
76 
77 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a3b1a91ee1ddc60fac7981f8cb5ea0368}\label{namespaceselect___a__dox_a3b1a91ee1ddc60fac7981f8cb5ea0368}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!main@{main}}
\index{main@{main}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



主函数 


\begin{DoxyCode}
641 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a3b1a91ee1ddc60fac7981f8cb5ea0368}{main}():
642     \textcolor{keyword}{global} tfBuffer, listener, amcl\_output, amcl\_init\_pose, odom\_pose, out\_pose, pub, pub\_amcl
643     \textcolor{keywordflow}{try}:
644         rospy.init\_node(\textcolor{stringliteral}{'combined\_test'})
645         tfBuffer = tf2\_ros.Buffer()
646         listener = tf2\_ros.TransformListener(tfBuffer)
647         amcl\_pose = AMCL\_unit()
648         amcl\_output = AMCL\_unit()
649         amcl\_init\_pose = PoseWithCovarianceStamped()
650         gps\_pose = GPS\_unit()
651         odom\_pose = Odom\_unit()
652         out\_pose = SELECTED()
653         rospy.Subscriber(\textcolor{stringliteral}{'/fuse/map\_odom'}, PoseWithCovarianceStamped, amcl\_pose.fix)
654         rospy.Subscriber(\textcolor{stringliteral}{'/Gnss\_Odom\_res'}, Gnss\_Odom\_lyz, gps\_pose.update)
655         rospy.Subscriber(\textcolor{stringliteral}{'/odom'}, Odometry, amcl\_pose.update)
656         rospy.Subscriber(\textcolor{stringliteral}{'/initialpose'}, PoseWithCovarianceStamped, amcl\_initial\_callback)
657         pub = rospy.Publisher(\textcolor{stringliteral}{'/fuse/tf'}, Fuse\_tf, queue\_size=100)
658         pub\_amcl = rospy.Publisher(\textcolor{stringliteral}{'/initialpose'}, PoseWithCovarianceStamped, queue\_size=1)
659 
660         t1 = threading.Thread(target=make\_choice)
661         t2 = threading.Thread(target=amcl\_process)
662         t1.start()
663         t2.start()
664 
665         rospy.spin()
666     \textcolor{keywordflow}{except} rospy.ROSInterruptException:
667         \textcolor{keywordflow}{pass}
668 
669 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a0a0029d6640915baf31f3cb76c0658ab}\label{namespaceselect___a__dox_a0a0029d6640915baf31f3cb76c0658ab}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!make\+\_\+choice@{make\+\_\+choice}}
\index{make\+\_\+choice@{make\+\_\+choice}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{make\+\_\+choice()}{make\_choice()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+make\+\_\+choice (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



筛选函数 


\begin{DoxyCode}
483 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a0a0029d6640915baf31f3cb76c0658ab}{make\_choice}():
484     rate = rospy.Rate(10)
485     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} rospy.is\_shutdown():
486         out\_pose.x = amcl\_output.x
487         out\_pose.y = amcl\_output.y
488         out\_pose.theta = amcl\_output.theta
489         out\_pose.set\_map(out\_pose.x, out\_pose.y, out\_pose.theta)
490         \textcolor{comment}{# sendRVIZ()}
491         \hyperlink{namespaceselect___a__dox_a6b1af471c24514010bab83a744995d30}{sendTransform}(out\_pose)
492         \textcolor{comment}{# amcl\_pose.lock()}
493         \textcolor{comment}{# gps\_pose.lock()}
494 
495         rate.sleep()
496 
497 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_aeb9ae60d7e093e9212176c74ab48f697}\label{namespaceselect___a__dox_aeb9ae60d7e093e9212176c74ab48f697}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!matrix\+\_\+from\+\_\+theta@{matrix\+\_\+from\+\_\+theta}}
\index{matrix\+\_\+from\+\_\+theta@{matrix\+\_\+from\+\_\+theta}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{matrix\+\_\+from\+\_\+theta()}{matrix\_from\_theta()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+matrix\+\_\+from\+\_\+theta (\begin{DoxyParamCaption}\item[{}]{theta }\end{DoxyParamCaption})}



角度生成旋转矩阵(2x2) 


\begin{DoxyParams}{Parameters}
{\em theta} & 输入角度\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
输出旋转矩阵 
\end{DoxyReturn}

\begin{DoxyCode}
87 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_aeb9ae60d7e093e9212176c74ab48f697}{matrix\_from\_theta}(theta):
88 
89     \textcolor{keywordflow}{return} np.array([[np.cos(theta), -np.sin(theta)], [np.sin(theta), np.cos(theta)]])
90 
91 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}\label{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!normalize@{normalize}}
\index{normalize@{normalize}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{normalize()}{normalize()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+normalize (\begin{DoxyParamCaption}\item[{}]{z }\end{DoxyParamCaption})}



归一化 


\begin{DoxyParams}{Parameters}
{\em z} & 角度输入\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
角度输出(0$\sim$pi) 
\end{DoxyReturn}

\begin{DoxyCode}
49 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a933f572519bc5396421db86a68a37916}{normalize}(z):
50 
51     \textcolor{keywordflow}{return} math.atan2(math.sin(z), math.cos(z))
52 
53 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a6b1af471c24514010bab83a744995d30}\label{namespaceselect___a__dox_a6b1af471c24514010bab83a744995d30}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!send\+Transform@{send\+Transform}}
\index{send\+Transform@{send\+Transform}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{send\+Transform()}{sendTransform()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+send\+Transform (\begin{DoxyParamCaption}\item[{}]{out\+\_\+pose }\end{DoxyParamCaption})}



发送\+T\+F(topic) 


\begin{DoxyParams}{Parameters}
{\em out\+\_\+pose} & ros输出格式数据 \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
437 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a6b1af471c24514010bab83a744995d30}{sendTransform}(out\_pose):
438 
439     pub.publish(out\_pose.fuse\_tf)
440 
441 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a7b416b405b394ffdf3fb7ca9d91bd896}\label{namespaceselect___a__dox_a7b416b405b394ffdf3fb7ca9d91bd896}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!theta\+\_\+from\+\_\+matrix@{theta\+\_\+from\+\_\+matrix}}
\index{theta\+\_\+from\+\_\+matrix@{theta\+\_\+from\+\_\+matrix}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{theta\+\_\+from\+\_\+matrix()}{theta\_from\_matrix()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+theta\+\_\+from\+\_\+matrix (\begin{DoxyParamCaption}\item[{}]{R }\end{DoxyParamCaption})}



旋转矩阵(2x2)转成角度 


\begin{DoxyParams}{Parameters}
{\em R} & 输入旋转矩阵\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
输出角度值 
\end{DoxyReturn}

\begin{DoxyCode}
101 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a7b416b405b394ffdf3fb7ca9d91bd896}{theta\_from\_matrix}(R):
102 
103     
106     \_R\_12 = R[0, 1]
107     
110     \_R\_22 = R[1, 1]
111     \textcolor{keywordflow}{if} -0.001 < \_R\_22 < 0.001 \textcolor{keywordflow}{and} \_R\_12 > 0:
112         theta = math.pi / 2
113     \textcolor{keywordflow}{elif} -0.001 < \_R\_22 < 0.001 \textcolor{keywordflow}{and} \_R\_12 < 0:
114         theta = math.pi / 2
115     \textcolor{keywordflow}{elif} 0.001 <= \_R\_22 \textcolor{keywordflow}{and} \_R\_12 > 0:
116         theta = math.atan(\_R\_12 / \_R\_22)
117     \textcolor{keywordflow}{elif} 0.001 <= \_R\_22 \textcolor{keywordflow}{and} \_R\_12 < 0:
118         theta = math.atan(\_R\_12 / \_R\_22)
119     \textcolor{keywordflow}{elif} \_R\_22 <= -0.001 \textcolor{keywordflow}{and} \_R\_12 > 0:
120         theta = math.atan(\_R\_12 / \_R\_22) + math.pi
121     \textcolor{keywordflow}{elif} \_R\_22 <= -0.001 \textcolor{keywordflow}{and} \_R\_12 < 0:
122         theta = math.atan(\_R\_12 / \_R\_22) - math.pi
123     \textcolor{keywordflow}{return} theta
124 
125 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_ac19f6260515ad57d2a375614405ec33d}\label{namespaceselect___a__dox_ac19f6260515ad57d2a375614405ec33d}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!tran\+\_\+mat44@{tran\+\_\+mat44}}
\index{tran\+\_\+mat44@{tran\+\_\+mat44}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{tran\+\_\+mat44()}{tran\_mat44()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+tran\+\_\+mat44 (\begin{DoxyParamCaption}\item[{}]{trans }\end{DoxyParamCaption})}



将ros格式中的\+Transform数据转为矩阵(4\+X4) 


\begin{DoxyParams}{Parameters}
{\em trans} & ros格式\+Transform数据 \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
448 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_ac19f6260515ad57d2a375614405ec33d}{tran\_mat44}(trans):
449 
450     trans\_xyz = [trans.transform.translation.x, trans.transform.translation.y, 0]
451     trans\_quat = [0, 0, trans.transform.rotation.z,
452                   trans.transform.rotation.w]
453     mat44 = np.dot(tft.translation\_matrix(trans\_xyz), tft.quaternion\_matrix(trans\_quat))
454     \textcolor{keywordflow}{return} mat44
455 
456 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceselect___a__dox_a62a8e3ea1a92df75e0ca42190f621777}\label{namespaceselect___a__dox_a62a8e3ea1a92df75e0ca42190f621777}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!tran\+\_\+theta\+\_\+T@{tran\+\_\+theta\+\_\+T}}
\index{tran\+\_\+theta\+\_\+T@{tran\+\_\+theta\+\_\+T}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{tran\+\_\+theta\+\_\+\+T()}{tran\_theta\_T()}}
{\footnotesize\ttfamily def select\+\_\+\+A\+\_\+dox.\+tran\+\_\+theta\+\_\+T (\begin{DoxyParamCaption}\item[{}]{trans }\end{DoxyParamCaption})}



将ros格式中的\+Transform数据转为矩阵(2\+X2) 


\begin{DoxyParams}{Parameters}
{\em trans} & ros格式\+Transform数据 \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
463 \textcolor{keyword}{def }\hyperlink{namespaceselect___a__dox_a62a8e3ea1a92df75e0ca42190f621777}{tran\_theta\_T}(trans):
464 
465     
468     \_quat = [trans.transform.rotation.x, trans.transform.rotation.y,
469              trans.transform.rotation.z,
470              trans.transform.rotation.w]
471     
474     \_theta = tft.euler\_from\_quaternion(\_quat)[2]
475     
478     \_T = np.array([[trans.transform.translation.x], [trans.transform.translation.y]])
479     \textcolor{keywordflow}{return} \_theta, \_T
480 
481 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceselect___a__dox_aab650782f9bf9e653748df1ce43ba0a3}\label{namespaceselect___a__dox_aab650782f9bf9e653748df1ce43ba0a3}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!flag\+\_\+robot\+\_\+move@{flag\+\_\+robot\+\_\+move}}
\index{flag\+\_\+robot\+\_\+move@{flag\+\_\+robot\+\_\+move}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{flag\+\_\+robot\+\_\+move}{flag\_robot\_move}}
{\footnotesize\ttfamily int select\+\_\+\+A\+\_\+dox.\+flag\+\_\+robot\+\_\+move = 0}



机器人是否运动标志 

\mbox{\Hypertarget{namespaceselect___a__dox_ae625bd87a3d659c478623a68cd8419a0}\label{namespaceselect___a__dox_ae625bd87a3d659c478623a68cd8419a0}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!M\+A\+X\+\_\+\+S\+TD@{M\+A\+X\+\_\+\+S\+TD}}
\index{M\+A\+X\+\_\+\+S\+TD@{M\+A\+X\+\_\+\+S\+TD}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{M\+A\+X\+\_\+\+S\+TD}{MAX\_STD}}
{\footnotesize\ttfamily int select\+\_\+\+A\+\_\+dox.\+M\+A\+X\+\_\+\+S\+TD = 999999999}



最大的标准差 

\mbox{\Hypertarget{namespaceselect___a__dox_a8c2c2dd96dd9f11315bf9092c248b7f6}\label{namespaceselect___a__dox_a8c2c2dd96dd9f11315bf9092c248b7f6}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR@{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR}}
\index{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR@{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR}{STATIC\_LIMIT\_ANGULAR}}
{\footnotesize\ttfamily float select\+\_\+\+A\+\_\+dox.\+S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+A\+N\+G\+U\+L\+AR = 0.\+05}



判断机器人是否运动的角度限制 

\mbox{\Hypertarget{namespaceselect___a__dox_a0fedd571655449b271f61079a0c85510}\label{namespaceselect___a__dox_a0fedd571655449b271f61079a0c85510}} 
\index{select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}!S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR@{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR}}
\index{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR@{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR}!select\+\_\+\+A\+\_\+dox@{select\+\_\+\+A\+\_\+dox}}
\subsubsection{\texorpdfstring{S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR}{STATIC\_LIMIT\_LINEAR}}
{\footnotesize\ttfamily float select\+\_\+\+A\+\_\+dox.\+S\+T\+A\+T\+I\+C\+\_\+\+L\+I\+M\+I\+T\+\_\+\+L\+I\+N\+E\+AR = 0.\+05}



判断机器人是否运动的速度限制 

